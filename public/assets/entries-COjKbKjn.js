import{f as s}from"./fetch-DFxpFdnl.js";function h(t){const e=new Date(t),n=new Date(e.getTime()+2*60*60*1e3),o=n.getDate(),d=n.getMonth()+1,c=n.getFullYear();return`${o<10?"0":""}${o}.${d<10?"0":""}${d}.${c}`}const f=document.querySelector(".activelogout"),v=function(t){t.preventDefault(),window.location.href="home.html"};f.addEventListener("click",v);const k=document.querySelector(".home"),I=function(t){window.location.href="home.html"};k.addEventListener("click",I);document.addEventListener("DOMContentLoaded",B);async function B(){const t="http://localhost:3000/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};s(t,n).then(o=>{console.log(o),console.log(o.user.username),document.getElementById("username").innerHTML=o.user.username})}document.addEventListener("DOMContentLoaded",E);async function E(){console.log("Haetaa kaikki käyttäjät");const t="http://127.0.0.1:3000/api/entries";let e=localStorage.getItem("token");console.log(e);const n={method:"GET",headers:{Authorization:"Bearer "+e}};try{const o=await s(t,n);console.log(o),D(o)}catch(o){console.error("Error fetching entries:",o)}}function D(t){console.log(t);const e=document.querySelector(".tableBody");e.innerHTML="",t.forEach(n=>{console.log(n.entry_date,n.mood,n.crying,n.breakdowns,n.notes,n.entry_id);const o=document.createElement("tr"),d=document.createElement("td");d.innerText=h(n.entry_date);const c=document.createElement("td");c.innerText=n.mood;const l=document.createElement("td");l.innerText=n.crying+" times";const y=document.createElement("td");y.innerText=n.breakdowns+" times";const p=document.createElement("td");p.innerText=n.notes;const g=document.createElement("td");g.innerText=n.entry_id,o.appendChild(d),o.appendChild(c),o.appendChild(l),o.appendChild(y),o.appendChild(p),o.appendChild(g),e.appendChild(o)})}async function w(t){console.log("Getting info");const e=document.querySelector("#editId").value;console.log(e);const n=`http://127.0.0.1:3000/api/entries/${e}`,d={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};try{return await s(n,d)}catch(c){throw console.error("Error fetching entry data:",c),c}}async function b(t){const e=parseInt(document.querySelector("#editId").value);console.log(e),console.log("Saving changes for entry ID: ",e);const n={mood:document.getElementById("editMood").value,crying:parseInt(document.getElementById("editCrying").value),breakdowns:parseInt(document.getElementById("editBreakdowns").value),notes:document.getElementById("editNotes").value};console.log(n),console.log("here");const o=`http://127.0.0.1:3000/api/entries/${e}`,d=localStorage.getItem("token");console.log(d);const c={method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+d}};s(o,c).then(l=>(console.log(l),console.log("Entry updated successfully:",l),l)).catch(l=>{console.error("Error updating status:",l)})}const a=document.getElementById("editPopup"),r=document.getElementById("editOverlay"),L=document.querySelector(".editBtn"),S=document.getElementById("closeEdit"),T=document.querySelector(".submitEdit");L.addEventListener("click",function(t){t.preventDefault(),a.style.display="block",r.style.display="block"});S.addEventListener("click",function(){a.style.display="none",r.style.display="none"});const i=document.getElementById("editModal"),M=document.querySelector(".closeModal"),C=document.getElementById("editModal");function q(t){console.log("Opening entry:",t),w().then(e=>{document.getElementById("editMood").value=e.mood,document.getElementById("editCrying").value=e.crying,document.getElementById("editBreakdowns").value=e.breakdowns,document.getElementById("editNotes").value=e.notes,i.style.display="block",r.style.display="block"}).catch(e=>{console.error("Error fetching entry data:",e)}),i.style.display="block"}T.addEventListener("click",function(t){t.preventDefault();const e=document.getElementById("editId").value;a.style.display="none",q(e)});M.addEventListener("click",function(){i.style.display="none",r.style.display="none"});C.addEventListener("submit",function(t){t.preventDefault(),b(),i.style.display="none",r.style.display="none",location.reload()});async function $(t){console.log("Deleting entry");const e=document.querySelector("#deleteId").value;if(console.log("Entry ID to delete:",e),!confirm(`Are you sure you want to delete entry with ID: ${e}?`))return;const o=`http://127.0.0.1:3000/api/entries/${e}`,c={method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};s(o,c).then(l=>{console.log("Entry deleted successfully:",l),E()}).catch(l=>{console.error("Failed to delete entry:",l)})}const u=document.getElementById("deletePopup"),m=document.getElementById("deleteOverlay"),O=document.querySelector(".deleteBtn"),x=document.getElementById("closeDelete"),A=document.querySelector(".submitDelete");O.addEventListener("click",function(t){console.log("here"),t.preventDefault(),u.style.display="block",m.style.display="block"});x.addEventListener("click",function(){u.style.display="none",m.style.display="none"});A.addEventListener("click",function(t){t.preventDefault(),u.style.display="none",m.style.display="none",$()});
