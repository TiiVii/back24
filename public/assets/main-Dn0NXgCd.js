import{f as l}from"./fetch-DFxpFdnl.js";window.addEventListener("load",()=>{p()});const y=document.querySelector(".submit_user"),d=document.getElementById("successOverlay"),m=document.getElementById("successPopup"),g=document.getElementById("closeSuccess");y.addEventListener("click",async o=>{o.preventDefault(),console.log("Creating a new account");const n="https://teevee.swedencentral.cloudapp.azure.com/api/users",e=document.querySelector(".create_user");if(!e.checkValidity()){e.reportValidity();return}const s=document.querySelector("input[name=username]").value,a=document.querySelector("input[name=password]").value,i=document.querySelector("input[name=email]").value,r={username:s,password:a,email:i};console.log(r);const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{const c=await l(n,t);console.log(c),c.message==="new user created"?(m.style.display="block",d.style.display="block"):alert("Something went wrong")}catch(c){console.error(c),alert("An error occurred. Please try again later.")}});g.addEventListener("click",function(){m.style.display="none",d.style.display="none"});const S=document.querySelector(".loginuser");S.addEventListener("click",async o=>{o.preventDefault();const n="https://teevee.swedencentral.cloudapp.azure.com/api/auth/login",e=document.querySelector(".login_user"),s=e.querySelector("input[name=username]").value,a=e.querySelector("input[name=password]").value,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:a})};try{const t=await l(n,r);console.log(t),t.token===void 0?alert("Username or password is incorrect"):(localStorage.setItem("token",t.token),localStorage.setItem("user_id",t.user.user_id),window.location.href="home.html",u("loginResponse",`localStorage set with token value: ${t.token}`))}catch(t){console.error(t),alert("An error occurred. Please try again later.")}});const h=document.querySelector(".loginuser");h.addEventListener("click",async()=>{console.log("Testing token and retrieving the user info");const o="https://teevee.swedencentral.cloudapp.azure.com/api/auth/me",n=localStorage.getItem("token");console.log(n);const e={method:"GET",headers:{Authorization:"Bearer: "+n}};console.log(e),l(o,e).then(s=>{console.log(s),u("meResponse",`Authorized user info: ${JSON.stringify(s)}`)})});const f=document.querySelector("#clearButton");f.addEventListener("click",p);function u(o,n){const e=document.getElementById(o);e?e.innerText=n:console.log(`Element with ID '${o}' not found.`)}function p(){localStorage.removeItem("token"),localStorage.removeItem("user_id"),u("clearResponse","localStorage cleared!")}
